!function(a,b){"use strict";function c(){m.find(".select2").select2(),m.find(".start_actions").click(h),u.bind("keyup change",d).trigger("change"),v.bind("click",f).find("input:checked").trigger("click"),w.bind("click",g).find("input:checked").trigger("click"),x.delegate(".show_error","click",l)}function d(a){if("change"!=a.type||"INPUT"!=a.target.nodeName){var c=u.find(":input").serializeArray();c.push({name:"ajax_method",value:"load_batch_images"}),c.push({name:"site_id",value:ChannelImages.site_id}),c.push({name:"XID",value:EE.XID}),b.ajax({url:ChannelImages.AJAX_URL,type:"POST",dataType:"json",data:c,crossDomain:!0,success:function(a){q=a.ids,s=q.length,t=a.field_ids,m.find(".total_count").html(s),e()},error:function(){}})}}function e(){m.find(".action-regen .image_sizes").empty();var a=[];a.push({name:"ajax_method",value:"get_image_sizes"}),a.push({name:"field_ids",value:t.join(",")}),a.push({name:"XID",value:EE.XID}),b.ajax({url:ChannelImages.AJAX_URL,type:"POST",dataType:"json",data:a,success:function(a){if(a.fields){for(var b="",c=0;c<a.fields.length;c++)b+=ChannelImages.Templates.mcp_regen_fieldsizes(a.fields[c]);m.find(".action-regen .image_sizes").html(b)}},error:function(){}})}function f(){n=v.find("input:checked").val(),m.find("table.actions").hide(),m.find("table.action-"+n).show()}function g(){var a=w.find("input:checked").val();m.find("tbody.options").hide(),m.find("tbody.option-"+a).show()}function h(a,b){o||"transfer"!=n?p=m.find(".action-regen").find(":input").serializeArray():o=m.find(".action-transfer").find(":input").serializeArray();for(var c=0;c<q.length;c++)if(q[c]&&!q[c].done)return b||(b=x.find(".current-actions").append("<tr></tr>").find("tr:last")),void i(c,b);k(null,b,!0)}function i(a,c){var d=[];d="transfer"==n?m.find(".action-transfer").find(":input").serializeArray():m.find(".action-regen").find(":input").serializeArray(),d.push({name:"id",value:q[a].id}),d.push({name:"action",value:n}),d.push({name:"ajax_method",value:"exec_batch"}),d.push({name:"XID",value:EE.XID}),q[a].done=!0,q[a].loading=!0,k(a,c),b.ajax({url:ChannelImages.AJAX_URL+"&image_id="+q[a].id,type:"POST",dataType:"json",data:d,success:function(){j(a,c)},error:function(b){j(a,c,b)}})}function j(a,c,d){var e;return d?void b.ajax({url:ChannelImages.AJAX_URL,type:"POST",dataType:"json",data:{ajax_method:"get_image_details",id:q[a].id,XID:EE.XID},success:function(b){q[a].entry=b.entry,q[a].channel=b.channel,q[a].field=b.field,q[a].image=b.image,q[a].ajax_error=d.responseText,q[a].loading=!1,q[a].retry_count?q[a].retry_count--:q[a].retry_count=3,q[a].retry=q[a].retry_count?!0:!1,k(a,c),q[a].retry&&setTimeout(function(){q[a].ajax_error=!1,i(a,c)},3e3)}}):(r.push(q[a].id),e=100/s*r.length,x.find(".progress").css("width",e+"%").find(".total_done").html(r.length),h(null,c),void delete q[a])}function k(a,b,c){var d;d=c?{action_done:!0}:q[a],b||(b=x.find(".current-actions").find("tr:last")),b.html(ChannelImages.Templates.mcp_batch_action_row(d))}function l(a){var c=b(a.target).closest(".action_error").find("script").html();b("#ci_ajax_error").show().find("iframe").contents().find("html").html(c)}var ChannelImages=a.ChannelImages=a.ChannelImages||{},m=b("#cimcp");if(m.length>0){var n,o,p,q=[],r=[],s=0,t=[],u=m.find(".image-filters"),v=m.find(".action-toggler"),w=m.find(".transfer-toggle"),x=m.find(".progress_holder");c()}}(window,jQuery);
//# sourceMappingURL=mcp.min.map